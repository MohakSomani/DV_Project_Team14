<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian Map Chloropleth</title>
    <style>
        /* Add your CSS styles here */
        body,
        html {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
        }

        #container {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        #heading {
            flex: 1;
            text-align: center;
            padding: 20px;
        }

        #map-container {
            flex: 3;
            width: 100%;
            /* Make the map container take up the full width */
            overflow: hidden;
            /* Hide overflowing content */
        }

        .tooltip {
            position: absolute;
            background-color: rgba(54, 54, 54, 0.7);
            color: white;
            padding: 5px;
            border-radius: 5px;
            pointer-events: none;
            opacity: 0;
        }

        #year-dropdown {
            padding: 10px;
            font-size: 16px;
            border: 1px solid steelblue;
            border-radius: 5px;
            background-color: #f0f0f0;
            color: steelblue;
            width: 100%;
            box-sizing: border-box;
        }
    </style>
</head>

<body>
    <div id="container">
        <div id="heading">
            <h1>Indian Map Chloropleth</h1>
            <select id="year-dropdown">
                <option value="1962">1962</option>
                <option value="1967">1967</option>
                <option value="1971">1971</option>
                <option value="1977">1977</option>
                <option value="1980">1980</option>
                <option value="1984">1984</option>
                <option value="1989">1989</option>
                <option value="1991">1991</option>
                <option value="1996">1996</option>
                <option value="1998">1998</option>
                <option value="1999">1999</option>
                <option value="2004">2004</option>
                <option value="2009">2009</option>
                <option value="2014">2014</option>
                <option value="2019">2019</option>
            </select>

        </div>
        <div id="map-container">
            <svg id="india-map" width="1000" height="800"></svg>
        </div>
    </div>

    <div class="tooltip"></div>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        // Define the width and height of the SVG
        var width = 1000;
        var height = 800;

        // Create an SVG element
        var svg = d3.select("#india-map")
            .attr("width", width)
            .attr("height", height);

        // Define color scale
        var colorScale = d3.scaleSequential(d3.interpolateBlues);

        // Load GeoJSON data
        d3.json("india_pc_2012-17.json").then(function (geojson) {

            // Define a projection for the map (you might need to adjust this)
            var projection = d3.geoMercator()
                .fitSize([width, height], geojson);

            // Define a path generator
            var path = d3.geoPath()
                .projection(projection);

            // Load data from CSV file
            d3.csv("modified_data.csv").then(function (data) {

                // Add event listener to the year dropdown
                document.getElementById("year-dropdown").addEventListener("change", function () {
                    // Redraw the map with new data based on selected year
                    var year = this.value;

                    // Extract turnout data for the selected year
                    var yearInt = parseInt(year); // Convert year to integer

                    var turnoutData = {};
                    data.forEach(function (d) {
                        if (parseInt(d.year) === parseInt(yearInt)) {
                            turnoutData[d.Pc_name] = parseInt(d.Turnout);
                        }
                    });

                    // Update color domain based on the new data
                    var maxTurnout = d3.max(Object.values(turnoutData));
                    colorScale.domain([0, maxTurnout]);

                    // Draw the map
                    svg.selectAll(".constituency")
                        .data(geojson.features)
                        .enter().append("path")
                        .attr("class", "constituency")
                        .attr("d", path)
                        .style("fill", function (d) {
                            var pcName = d.properties.PC_NAME.charAt(0).toUpperCase() + d.properties.PC_NAME.slice(1).toLowerCase();
                            return colorScale(turnoutData[pcName] || 0);
                        })
                        .on("mouseover", function (event, d) {
                            console.log(pc);
                            d3
                                .select(this)
                                .style("stroke", "cyan")
                                .style("stroke-width", 2);
                            // Extract constituency properties
                            var pc = d.properties; // Extract properties directly from the data
                            if (pc && pc.PC_NAME) {
                                var pcName = pc.PC_NAME.charAt(0).toUpperCase() + pc.PC_NAME.slice(1).toLowerCase();
                                var value = turnoutData[pcName] || "N/A";
                                // Show tooltip
                                tooltip.style("opacity", 1)
                                    .html("Constituency: " + pcName + "<br>" + "Value: " + value)
                                    .style("left", (event.pageX + 10) + "px")
                                    .style("top", (event.pageY - 28) + "px");
                            }
                        })

                        .on("mouseout", function () {
                            d3.select(this)
                                .style("stroke", "black")
                                .style("stroke-width", 0.5);

                            // Hide tooltip
                            tooltip.style("opacity", 0);
                        });
                });

                // Trigger change event to initially load data for the default year
                document.getElementById("year-dropdown").dispatchEvent(new Event("change"));
            });
        });

        // Append tooltip element
        const tooltip = d3.select
            ("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
    </script>
</body>

</html>